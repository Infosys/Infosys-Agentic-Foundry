# Stage 1: Build the React app
FROM node:22-alpine as build
WORKDIR /app
 
# Copy package metadata
COPY package*.json ./
 
# Use NPM auth token from secret securely (not baked into final image)
RUN rm -rf node_modules package-lock.json && \
    npm cache clean --force && \
    npm install
 
# Copy rest of the app
COPY . .
 
ENV PORT=3003
 
EXPOSE 3003
CMD ["npm", "start"]